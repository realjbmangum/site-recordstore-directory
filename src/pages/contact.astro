---
import BaseLayout from '../layouts/BaseLayout.astro';
import siteConfig from '../data/site-config.json';
---

<BaseLayout
  title="Contact Us"
  description="Get in touch with the RecordStores team. We'd love to hear from you about store submissions, partnerships, or just to say hello."
>
  <div class="container-page py-12 md:py-16">
    <div class="max-w-2xl mx-auto">
      <h1 class="font-display text-3xl md:text-4xl font-bold text-ink-900 mb-4">
        Contact Us
      </h1>
      <p class="text-ink-600 mb-8">
        Have a question, suggestion, or just want to say hello? We'd love to hear from you.
      </p>

      <div class="bg-white rounded-xl border border-ink-200 p-6 md:p-8">
        <form id="contact-form">
          <div class="mb-6">
            <label for="name" class="block text-sm font-medium text-ink-700 mb-2">
              Name <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              id="name"
              name="name"
              required
              class="w-full px-4 py-3 rounded-lg border border-ink-300 focus:outline-none focus:ring-2 focus:ring-groove-500 focus:border-transparent"
            />
          </div>

          <div class="mb-6">
            <label for="email" class="block text-sm font-medium text-ink-700 mb-2">
              Email <span class="text-red-500">*</span>
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-4 py-3 rounded-lg border border-ink-300 focus:outline-none focus:ring-2 focus:ring-groove-500 focus:border-transparent"
            />
          </div>

          <div class="mb-6">
            <label for="subject" class="block text-sm font-medium text-ink-700 mb-2">
              Subject
            </label>
            <input
              type="text"
              id="subject"
              name="subject"
              class="w-full px-4 py-3 rounded-lg border border-ink-300 focus:outline-none focus:ring-2 focus:ring-groove-500 focus:border-transparent"
            />
          </div>

          <div class="mb-6">
            <label for="message" class="block text-sm font-medium text-ink-700 mb-2">
              Message <span class="text-red-500">*</span>
            </label>
            <textarea
              id="message"
              name="message"
              rows="6"
              required
              class="w-full px-4 py-3 rounded-lg border border-ink-300 focus:outline-none focus:ring-2 focus:ring-groove-500 focus:border-transparent"
            ></textarea>
          </div>

          <button type="submit" class="btn-primary w-full justify-center py-4">
            Send Message
          </button>

          <div id="form-message" class="mt-4 hidden"></div>
        </form>
      </div>

      <div class="mt-8 text-center">
        <p class="text-ink-500 text-sm">
          You can also reach us directly at{' '}
          <a href={`mailto:${siteConfig.contact.email}`} class="text-groove-600 hover:underline">
            {siteConfig.contact.email}
          </a>
        </p>
      </div>
    </div>
  </div>
</BaseLayout>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const messageDiv = document.getElementById('form-message') as HTMLDivElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Sending...';
    submitBtn.disabled = true;

    try {
      const web3formsKey = import.meta.env.PUBLIC_WEB3FORMS_KEY;
      if (web3formsKey) {
        await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            access_key: web3formsKey,
            subject: `Contact Form: ${formData.get('subject') || 'No subject'}`,
            from_name: 'RecordStores',
            name: formData.get('name'),
            email: formData.get('email'),
            message: formData.get('message'),
          }),
        });
      }

      messageDiv.className = 'mt-4 p-4 bg-green-50 text-green-700 rounded-lg';
      messageDiv.textContent = 'Thank you for your message! We\'ll get back to you soon.';
      messageDiv.classList.remove('hidden');
      form.reset();
    } catch (error) {
      messageDiv.className = 'mt-4 p-4 bg-red-50 text-red-700 rounded-lg';
      messageDiv.textContent = 'Something went wrong. Please try again.';
      messageDiv.classList.remove('hidden');
    } finally {
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    }
  });
</script>
